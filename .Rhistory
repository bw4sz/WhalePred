rice<-aggregate(ice,fact=0.1/res(ice))
#coast
distc<-raster("InputData/DistancetoCoast.tif")
distc[is.na(rice)]<-NA
plot(distc)
rice
#ice
ice<-raster("InputData/ETOPO1_Ice_g_geotiff.tif")
ice<-round(ice*-1/1000,3)
rice<-aggregate(ice,fact=0.1/res(ice))
#coast
distc<-raster("InputData/DistancetoCoast.tif")
rice[rice<0]<-NA
distc[is.na(rice)]<-NA
plot(distc)
meanpar<-pc %>% filter(parameter %in% c('beta_mu',"beta2_mu",'alpha_mu'))  %>% group_by(par) %>% summarize(mean=mean(value)) %>% dcast(...~par)
##Bathymetry
meanpar<-pc %>% filter(parameter %in% c('beta_mu',"beta2_mu",'alpha_mu'))  %>% group_by(par) %>% summarize(mean=mean(value)) %>% dcast(...~par)
load("SingleSpecies.RData")
mice<-stack("InputData/MonthlyIceRaster.grd")
meanpar<-pc %>% filter(parameter %in% c('beta_mu',"beta2_mu",'alpha_mu'))  %>% group_by(par) %>% summarize(mean=mean(value)) %>% dcast(...~par)
s<-stack(rice,distc)
plot(s)
travpar<-calc(s,function(x,y){ inv.logit(meanpar$`alpha_mu[1]` + meanpar$`beta_mu[1]` * x[1] + meanpar$`beta2_mu[1]` * x[2])})
travdf<-data.frame(rasterToPoints(travpar))
data.frame(rasterToPoints(mice[[14]]))
a<-data.frame(rasterToPoints(mice[[14]]))
head(a)
a$Feb_2013
table(a$Feb_2013)
head(mice)
ggmap(temp) + labs(fill="Mean Probabilty of Feeding")+ geom_tile(data=travdf,aes(x=x, y=y,fill=layer),alpha=0.9)  + scale_color_discrete(guide="none") + scale_fill_continuous(low="blue",high="red") + xlim(-70,-50) + ylim(-67.5,-60)
theme(axis.text.x=element_blank(),axis.text.y=element_blank())
rasterToPoints(mice[[19]])
plot(mice[[19]])
plot(aggregate(mice[[19]],10))
ggmap(temp) + labs(fill="Mean Probabilty of Feeding")+ geom_tile(data=feedf,aes(x=x, y=y,fill=layer),alpha=0.9)  + scale_color_discrete(guide="none") + scale_fill_continuous(low="blue",high="red") + geom_tile(data=data.frame(rasterToPoints(aggregate(mice[[19]],10))),aes(x=x,y=y,fill=Jul_2013),alpha=0.8,fill='snow2') + ggtitle("July 2013") + theme(axis.text.x=element_blank(),axis.text.y=element_blank())  + xlim(-70,-50) + ylim(-67.5,-60)
library(knitr)
opts_chunk$set(echo=F,warning=F,message=F,fig.width = 11,fig.height = 5)
library(boot)
library(raster)
library(reshape2)
library(ggplot2)
library(survival)
library(MASS)
library(ggmap)
library(dplyr)
library(chron)
library(gridExtra)
library(stringr)
library(R2jags)
library(move)
#New model to be run, flag turned off if just updating.
newModel<-T
ggmap(temp)
load("SingleSpecies.RData")
ggmap(temp)
ggmap(temp) + xlim(-70,50)
ggmap(temp) + xlim(-70,-50)
ggmap(temp) + xlim(-70,-48)
ggmap(temp) + xlim(-70,-52)
ggmap(temp) + xlim(-70,-52) + ylim(-67.5,-60)
ggmap(temp) + xlim(-70,-52) + ylim(-67.5,-61)
r<-raster(msp,ext=extent(c(-70,-55,-66,-58))*1.1)
msp<-SpatialPointsDataFrame(cbind(mxy$x,mxy$y),data=mxy[,c("x","y","Animal","phi","timestamp")],proj=CRS("+proj=longlat +datum=WGS84"))
r<-raster(msp,ext=extent(c(-70,-55,-66,-58))*1.1)
res(r)<-0.1
m<-rasterize(x=msp,y=r,field="phi")
#plotting
feedmap <- data.frame(rasterToPoints(m))
temp <- get_map(location=bbox(m),source="google",zoom=5,maptype="satellite",color = "bw",scale = 2)
ggmap(temp) + labs(fill="Probabilty of Feeding")+ geom_tile(data=feedmap,aes(x=x, y=y,fill=layer),alpha=0.9) + theme_minimal() + scale_color_discrete(guide="none") + scale_fill_continuous(low="blue",high="red")
#read
shp<-list.files("InputData/SeaIce",pattern=".shp",full.names=T)
pols<-list()
for(a in 1:length(shp)){
rp<-readShapePoly(shp[[a]])
#define projection
stere <- "+proj=stere +lat_0=-90 +lat_ts=70 +lon_0=0 +datum=WGS84 +units=m"
proj4string(rp)<-stere
#0 width buffer
#rp <- gBuffer(rp, byid=TRUE, width=0)
#crop
e<-extent(-3455516,-757334.6,66739.71,2200756)*1.1
rmask<-raster(rp,ext=e)
rmask<-disaggregate(rmask,10)
rasP<-rasterize(rp,rmask)
#presence of ice
rasP <- projectRaster(rasP,crs=CRS("+proj=longlat +ellps=WGS84"))
rasP<-rasP>0
pols[[a]]<-rasP
#name the layers
#get naming structure
s<-str_match(shp[[a]],"S_(\\d+)_")[,2]
yr<-as.numeric(substring(s,0,4))
mn<-as.numeric(substring(s,5,6))
names(pols[[a]])<-paste(month.abb[mn],yr,sep="_")
}
spols<-stack(pols)
#writeindividaul raster
writeRaster(spols,"InputData/MonthlyIceRaster",overwrite=T)
library(maptools)
#read
shp<-list.files("InputData/SeaIce",pattern=".shp",full.names=T)
pols<-list()
for(a in 1:length(shp)){
rp<-readShapePoly(shp[[a]])
#define projection
stere <- "+proj=stere +lat_0=-90 +lat_ts=70 +lon_0=0 +datum=WGS84 +units=m"
proj4string(rp)<-stere
#0 width buffer
#rp <- gBuffer(rp, byid=TRUE, width=0)
#crop
e<-extent(-3455516,-757334.6,66739.71,2200756)*1.1
rmask<-raster(rp,ext=e)
rmask<-disaggregate(rmask,10)
rasP<-rasterize(rp,rmask)
#presence of ice
rasP <- projectRaster(rasP,crs=CRS("+proj=longlat +ellps=WGS84"))
rasP<-rasP>0
pols[[a]]<-rasP
#name the layers
#get naming structure
s<-str_match(shp[[a]],"S_(\\d+)_")[,2]
yr<-as.numeric(substring(s,0,4))
mn<-as.numeric(substring(s,5,6))
names(pols[[a]])<-paste(month.abb[mn],yr,sep="_")
}
spols<-stack(pols)
#writeindividaul raster
writeRaster(spols,"InputData/MonthlyIceRaster",overwrite=T)
ggmap(temp) + geom_tile(data=feedmap,aes(x=x, y=y,fill=layer),alpha=0.7) + geom_point(data=krill,aes(x=GridMidpointDegreeLon,y=GridMidpointHalfDegreeLat,size=C1KRIcatchKG/1000)) + scale_fill_continuous(low="blue",high="red") + labs(fill="Probability of Feeding", size="Krill Catch (Metric Tons)") + scale_size_continuous(range=c(0,8)) + theme_inset()
---
title: "Antarctic Whale Project: Single Species"
author: "Ben Weinstein"
date: "`r Sys.time()`"
output:
html_document:
keep_md: true
number_sections: true
toc: true
theme: spacelab
---
```{r,warning=FALSE,message=FALSE,echo=FALSE}
library(knitr)
opts_chunk$set(echo=F,warning=F,message=F,fig.width = 11,fig.height = 5)
library(boot)
library(raster)
library(reshape2)
library(ggplot2)
library(survival)
library(MASS)
library(ggmap)
library(dplyr)
library(chron)
library(gridExtra)
library(stringr)
library(R2jags)
library(move)
#New model to be run, flag turned off if just updating.
newModel<-T
```
```{r,eval=F}
#Load in data
load("SingleSpecies.RData")
#jags$recompile()
newModel<-F
```
#Abstract
```{r}
#raster layers
#ice
ice<-raster("InputData/ETOPO1_Ice_g_geotiff.tif")
ice<-round(ice*-1/1000,3)
rice<-aggregate(ice,fact=0.1/res(ice))
#coast
distc<-raster("InputData/DistancetoCoast.tif")
rice[rice<0]<-NA
distc[is.na(rice)]<-NA
#read data
mdat<-read.csv("InputData/Antarctic Humpback overlap with krill fisheries -1133643618235885002.csv")
##need to look into making into a movebank object.
#name env columns
#Create a oceandepth in km
mdat$ocean<-round(mdat$ETOPO1.Elevation * -1 /1000,3)
mdat$coast<-round(mdat$NASA.Distance.to.Coast,1)
mdat$SST<-mdat$MODIS.Ocean.Aqua.OceanColor.4km.Monthly.Daytime.SST
mdat$ChloroA<-mdat$MODIS.Ocean.Aqua.OceanColor.4km.Monthly.Chlorophyll.A
#standardize column names to match the simulation
#Create an animal tag.
mxy <- as(mdat, "data.frame")
mxy$Animal<-mxy$individual.local.identifier
mxy$x<-mxy$location.long
mxy$y<-mxy$location.lat
#grab set of animals
#mxy<-mxy[mxy$Animal %in% c("112699","121207","131151","112703","121211","131132","112737","131156","12326","123232","112705","154187","121210","131134","131141","112701","131159","131142","131144","154186","123224"),]
mxy<-mxy[mxy$Animal %in% c("131144","154186","123224","131132","112737","131156","131134","131141"),]
mxy$Animal<-as.numeric(as.factor(mxy$Animal))
#empty coordinates
mxy<-mxy[!is.na(mxy$x),]
#crop by extent
d<-SpatialPointsDataFrame(cbind(mxy$x,mxy$y),data=mxy)
d<-crop(d,y=extent(c(-70,-55,-66,-58)))
mxy<-as.data.frame(d)
#set datestamp
mxy$timestamp<-as.POSIXct(mxy$timestamp,format="%Y-%m-%d %H:%M:%S.000")
#remove empty timestamps
mxy<-mxy[!is.na(mxy$timestamp),]
#remove duplicates
mxy<-mxy[!duplicated(data.frame(mxy$timestamp,mxy$Animal)),]
```
#Descriptive Statistics
```{r}
#no distance to coast,elevation
mxy<-mxy[!mxy$ETOPO1.Elevation>0,]
```
```{r}
#hold copy of orig
oxy<-mxy
#Plot
pp<-c(mean(mxy$x),mean(mxy$y))
m <- get_map(location=pp,source="google",zoom=5,scale=2,maptype="satellite",color = "bw")
ggmap(m)+geom_path(data=mxy, aes(x=x, y=y,col=as.factor(Animal)),size=.5) + scale_color_discrete(guide="none") + theme_inset()
```
##Distance
```{r,fig.height=3}
moved<-move(x=mxy$x,y=mxy$y,time=as.POSIXct(mxy$timestamp),proj=CRS("+proj=longlat +ellps=WGS84"),animal=mxy$Animal,data=as.data.frame(mxy),sensor=mxy$Animal,removeDuplicatedTimestamps=T)
dstat<-melt(move::distanceSummary(moved))
dstat<-droplevels(dstat[dstat$variable %in% c("TravDist","AverDist","FarthDist"),])
levels(dstat$variable)<-c("Total Distance","Average Distance Between Points","Farthest Distance Between Points")
ggplot(dstat,aes(value/1000)) + geom_histogram() + facet_wrap(~variable,scales="free") + labs(x="Kilometers")
```
##Time
```{r,fig.height=3}
tstat<-move::timeSummary(moved)
tstat<-melt(tstat,measure.vars=colnames(tstat[[1]]))
tstat<-droplevels(tstat[tstat$variable %in% c("Duration","AverDur"),])
levels(tstat$variable)<-c("Total Time (Hours)","Average Time Between Points (Hours)")
ggplot(tstat,aes(value)) + geom_histogram() + facet_wrap(~variable,scales="free")
```
##Velocity
```{r,fig.height=3}
vstat<-move::speedSummary(moved)
vstat<-melt(vstat,measure.vars=colnames(vstat[[1]]))
levels(vstat$variable)<-c("Average Speed (m/s)","Variance in Speed (m/s)","Max Speed (m/s)")
ggplot(vstat,aes(value)) + geom_histogram() + facet_wrap(~variable,scales="free")
```
##Angles
```{r,fig.height=2}
astat<-move::angleSummary(moved)
astat<-melt(astat,measure.vars=colnames(astat[[1]]))
astat<-droplevels(astat[astat$variable %in% "AverAzimuth",])
levels(astat$variable)<-"Turning Angle (degrees)"
ggplot(astat,aes(value)) + geom_histogram() + facet_wrap(~variable,scales="free")
```
#Correlated random walk
*Process Model*
$$ d_{t} \sim T*d_{t-1} + Normal(0,\Sigma)$$
$$ x_t = x_{t-1} + d_{t} $$
## Parameters
For each individual:
$$\theta = \text{Mean turning angle}$$
$$\gamma = \text{Move persistence} $$
For both behaviors process variance is:
$$ \sigma_{latitude} = 0.1$$
$$ \sigma_{longitude} = 0.1$$
##Behavioral States
$$ \text{For each individual i}$$
$$ Behavior_1 = \text{traveling}$$
$$ Behavior_2 = \text{foraging}$$
$$ \alpha_{i,1,1} = \text{Probability of remaining traveling when traveling}$$
$$\alpha_{i,2,1} = \text{Probability of switching from feeding to traveling}$$
$$\begin{matrix}
\alpha_{i,1,1} & 1-\alpha_{i,1,1} \\
\alpha_{i,2,1} & 1-\alpha_{i,2,1} \\
\end{matrix}
$$
##Environment
Behavioral states are a function of local environmental conditions. The first environmental condition is ocean depth. I then build a function for preferential foraging in shallow waters.
It generally follows the form, conditional on behavior at t -1:
$$Behavior_t \sim Multinomial([\phi_{traveling},\phi_{foraging}])$$
$$logit(\phi_{traveling}) = \alpha_{Behavior_{t-1}} + \beta_1 * Ocean_{y[t,]}$$
$$logit(\phi_{foraging}) = \alpha_{Behavior_{t-1}} + \beta_2 * Ocean_{y[t,]}$$
```{r,fig.height=3,fig.width=3.5}
dplot<-function(a1,beta,beta2=0,x,coast=0){
y<-inv.logit(a1[1]+beta[1]*x + beta2*coast)
d11<-data.frame(x,y,State="Traveling",Begin="Traveling")
y<-1-inv.logit(a1[1]+beta[1]*x+ beta2*coast)
d12<-data.frame(x,y,State="Feeding",Begin="Traveling")
y<-inv.logit(a1[2]+beta[2]*x+ beta2*coast)
d21<-data.frame(x,y,State="Traveling",Begin="Feeding")
y<-1-inv.logit(a1[2]+beta[2]*x+ beta2*coast)
d22<-data.frame(x,y,State="Feeding",Begin="Feeding")
d<-rbind_all(list(d11,d12,d21,d22))
}
```
##Continious tracks
The transmitter will often go dark for 10 to 12 hours, due to weather, right in the middle of an otherwise good track. The model requires regular intervals to estimate the turning angles and temporal autocorrelation. As a track hits one of these walls, call it the end of a track, and begin a new track once the weather improves. We can remove any micro-tracks that are less than three days.
Specify a duration, calculate the number of tracks and the number of removed points. Iteratively.
```{r}
##Time is the beginning of the first point.
step_length=4
sxy<-split(mxy,mxy$Animal)
#time diff function
timed<-function(d,step_length){
d$j[1]<-0
for (x in 2:nrow(d)){
d$j[x]<-as.numeric(difftime(as.POSIXct(d$timestamp[x]),as.POSIXct(d$timestamp[x-1]),units="mins"))/(step_length*60)
}
#Split out track endings
ends<-c(1,which(d$j>1),nrow(d))
for(w in 2:length(ends)){
d[ends[w-1]:ends[w],"Track"]<-w-1
}
#remove tracks that are shorter than three days
track_time<-d %>% group_by(Track) %>% summarize(mt=difftime(max(as.POSIXct(timestamp)),min(as.POSIXct(timestamp)),units="hours")) %>% filter(mt>=8) %>% .$Track
d<-d[d$Track %in% track_time,]
#renumber the tracks
d$Track<-as.numeric(as.factor(d$Track))
return(d)
}
sxy<-lapply(sxy,timed,step_length=4)
#Format matrices for jags
mxy<-rbind_all(sxy)
######recode whales
#mxy$Animal<-as.numeric(as.factor(mxy$Animal))
sxy<-split(mxy,list(mxy$Animal,mxy$Track),drop=TRUE)
sxy<-lapply(sxy,function(x){
#How many observations in each step length segment
x$Step<-as.numeric(cut(as.POSIXct(x$timestamp),"4 hours"))
return(x)
})
mxy<-rbind_all(sxy)
```
```{r}
#total number of steps per track/animal
steps_all<-mxy %>% group_by(Animal,Track) %>% summarize(n=length(unique(Step)))
# give each step a label
mxy<-mxy %>% group_by(Animal,Track,Step) %>% mutate(jStep=1:n())
#Cast time array
j<-acast(mxy,Animal~Track~Step~jStep,value.var="j")
#how many observations per individual in each Step
mxy$Step<-factor(mxy$Step,levels=1:max(steps_all$n))
idx<-melt(table(mxy$Animal,mxy$Track,mxy$Step))
colnames(idx)<-c("Animal","Track","Step","jStep")
idx<-acast(data=idx,Animal~Track~Step)
#make ocean a matrix -> MEAN VALUE -> will this yield a jags error on empty cells?
oc<-acast(mxy,Animal~Track~Step,value.var="ocean",fun.aggregate = mean)
#make coast a matrix -> MEAN VALUE -> will this yield a jags error on empty cells?
coast<-acast(mxy,Animal~Track~Step,value.var="coast",fun.aggregate = mean)
#Individuals
ind=length(unique(mxy$Animal))
#tracks per indivudal
tracks<-mxy %>% group_by(Animal) %>% summarize(tracks=length(unique(Track))) %>% .$tracks
#steps per track
steps<-acast(steps_all,Animal~Track,value.var="n")
#obs array
obs<-melt(mxy,measure.vars=c("x","y"))
obs<-acast(obs,Animal~Track~Step~jStep~variable)
```
How did the filter change the extent of tracks?
```{r}
#Plot
mxy<-mxy %>% arrange(Animal,Track,Step,jStep)
pp<-c(mean(mxy$x),mean(mxy$y))
m <- get_map(location=pp,source="google",zoom=5,scale=2,maptype="satellite",color = "bw")
ggmap(m)+geom_path(data=mxy, aes(x=x, y=y,col=as.factor(Animal)),size=.5) + scale_color_discrete(guide="none") + theme_inset()
```
```{r,fig.height=15}
ggplot() +  geom_path(data=oxy,col='blue',aes(x=x,y=y)) +  geom_path(data=mxy,col='red',aes(x=x,y=y),size=2,alpha=0.7)  + facet_wrap(~Animal,scales="free",ncol=4)
```
```{r,fig.height=3,fig.width=5}
ggplot(data=steps_all,aes(x=n*step_length/24)) + geom_histogram() + labs(x="Days") + ggtitle("Track Length")
ggplot(data=steps_all,aes(x=Track)) + geom_histogram() + labs(x="Subtracks per Animal")
```
coastx<-seq(0,quantile(mxy$coast,0.98),quantile(mxy$coast,0.98)/20)
oceanx<-seq(0,quantile(mxy$ocean,0.98),quantile(mxy$ocean,0.98)/20)
allx<-expand.grid(coastx,oceanx)
colnames(allx)<-c("coast","ocean")
allx$alpha<-filter(pc,par %in% 'alpha_mu[1]') %>% group_by(parameter) %>% summarize(m=mean(value)) %>% .$m
allx$beta1<-filter(pc,par %in% 'beta_mu[2]') %>% group_by(parameter) %>% summarize(m=mean(value)) %>% .$m
allx$beta2<-filter(pc,par %in% 'beta2_mu[2]') %>% group_by(parameter) %>% summarize(m=mean(value)) %>% .$m
allx$beta1
head(pc)
allx$alpha<-filter(pc,par %in% 'alpha_mu[1]') %>% group_by(parameter) %>% summarize(m=mean(value)) %>% .$m
allx$alpha
allx$alpha<-filter(pc,par %in% 'alpha_mu[1]') %>% group_by(parameter) %>% summarize(m=mean(value)) %>% unique(.$m)
allx$alpha<-unique(filter(pc,par %in% 'alpha_mu[1]') %>% group_by(parameter) %>% summarize(m=mean(value)) %>% .$m)
allx$alpha
filter(pc,par %in% 'alpha_mu[1]') %>% group_by(parameter) %>% summarize(m=mean(value)) %>% .$m
allx$alpha<-filter(pc,par %in% 'alpha_mu[1]') %>% group_by(parameter) %>% summarize(m=mean(value)) %>% .$m
allx$beta1<-filter(pc,par %in% 'beta_mu[2]') %>% group_by(parameter) %>% summarize(m=mean(value)) %>% .$m
allx$beta2<-filter(pc,par %in% 'beta2_mu[2]') %>% group_by(parameter) %>% summarize(m=mean(value)) %>% .$m
head(allx)
traj<-function(ocean,coast,alpha,beta1,beta2){
p<-inv.logit(alpha + beta1*ocean + beta2*coast)
data.frame(ocean,coast,phi=p)
}
intplot<-allx %>% group_by(ID) %>% do(traj(.$ocean,.$coast,.$alpha,.$beta1,.$beta2))
coastx<-seq(0,quantile(mxy$coast,0.98),quantile(mxy$coast,0.98)/20)
oceanx<-seq(0,quantile(mxy$ocean,0.98),quantile(mxy$ocean,0.98)/20)
allx<-expand.grid(coastx,oceanx)
colnames(allx)<-c("coast","ocean")
allx$ID<-1:nrow(allx)
allx$alpha<-filter(pc,par %in% 'alpha_mu[1]') %>% group_by(parameter) %>% summarize(m=mean(value)) %>% .$m
allx$beta1<-filter(pc,par %in% 'beta_mu[2]') %>% group_by(parameter) %>% summarize(m=mean(value)) %>% .$m
allx$beta2<-filter(pc,par %in% 'beta2_mu[2]') %>% group_by(parameter) %>% summarize(m=mean(value)) %>% .$m
traj<-function(ocean,coast,alpha,beta1,beta2){
p<-inv.logit(alpha + beta1*ocean + beta2*coast)
data.frame(ocean,coast,phi=p)
}
intplot<-allx %>% group_by(ID) %>% do(traj(.$ocean,.$coast,.$alpha,.$beta1,.$beta2))
intplot
round(intplot$phi)
round(intplot$phi,2)
ggplot(intplot,aes(x=ocean,y=coast,fill=phi)) + geom_tile() + theme_bw() + labs(x="Ocean Depth (km)",y="Distance to coast (km)") + scale_fill_gradient(low="blue",high="red") + ggtitle("Mean Probability of Feeding when Traveling")
allx$beta2<-0.0178
allx$beta1<--0.55
traj<-function(ocean,coast,alpha,beta1,beta2){
p<-inv.logit(alpha + beta1*ocean + beta2*coast)
data.frame(ocean,coast,phi=p)
}
intplot<-allx %>% group_by(ID) %>% do(traj(.$ocean,.$coast,.$alpha,.$beta1,.$beta2))
ggplot(intplot,aes(x=ocean,y=coast,fill=phi)) + geom_tile() + theme_bw() + labs(x="Ocean Depth (km)",y="Distance to coast (km)") + scale_fill_gradient(low="blue",high="red") + ggtitle("Mean Probability of Feeding when Traveling")
feedpar<-calc(distc,function(x){ inv.logit(1-(meanpar$`alpha_mu[2]` + meanpar$`beta_mu[2]` * x)})
feedpar<-calc(distc,function(x){ inv.logit(1-(meanpar$`alpha_mu[2]` + meanpar$`beta_mu[2]` * x))})
#Cut by ice
feedf<-data.frame(rasterToPoints(feedpar))
plot(feedpar)
ggplot(postplot) + geom_ribbon(aes(x=x,y=mean,ymin=upper,ymax=lower,fill=State),alpha=0.5) + theme_bw() + labs(col="Transition",x="Ocean Depth (km)",y="Probability",fill="Transition") + facet_wrap(~Begin) + xlim(0,quantile(mxy$ocean,0.5))
postplot<-pc %>% filter(parameter %in% c('beta_mu','alpha_mu')) %>% dcast(.,Draw+chain~par) %>% group_by(Draw,chain) %>% do(dplot(a1=c(.$'alpha_mu[1]',.$'alpha_mu[2]'),beta=c(.$'beta_mu[1]',.$'beta_mu[2]'),x=unique(mxy$ocean))) %>% group_by(x=x,Begin,State) %>% summarize(mean=mean(y),lower=quantile(y,0.05),upper=quantile(y,0.95))
dplot
library(knitr)
opts_chunk$set(echo=F,warning=F,message=F,fig.width = 11,fig.height = 5)
library(boot)
library(raster)
library(reshape2)
library(ggplot2)
library(survival)
library(MASS)
library(ggmap)
library(dplyr)
library(chron)
library(gridExtra)
library(stringr)
library(R2jags)
library(move)
#New model to be run, flag turned off if just updating.
newModel<-T
load("SingleSpecies.RData")
MonthlyIceRaster.grd
```
mice
names(mice)
mice[25]
mice[[25]]
mice[[30]]
names(mice)
names(mice)
mn=25
ggmap(temp) + labs(fill="Mean Probabilty of Feeding")+ geom_tile(data=travdf,aes(x=x, y=y,fill=layer),alpha=0.9)  + scale_color_discrete(guide="none") + scale_fill_continuous(low="blue",high="red")+ geom_tile(data=data.frame(rasterToPoints(mice[[mn]])),aes_string(x=x,y=y,fill=names(mice)[[mn]]),alpha=0.8,fill='snow2') + ggtitle(names(mice)[[mn]])+theme(axis.text.x=element_blank(),axis.text.y=element_blank()) + xlim(-70,-50) + ylim(-67.5,-60) + labs(x="",y="")
ggmap(temp) + labs(fill="Mean Probabilty of Feeding")+ geom_tile(data=travdf,aes(x=x, y=y,fill=layer),alpha=0.9)  + scale_color_discrete(guide="none") + scale_fill_continuous(low="blue",high="red")+ geom_tile(data=data.frame(rasterToPoints(mice[[mn]])),aes(x=x,y=y),aes_string(fill=names(mice)[[mn]]),alpha=0.8,fill='snow2') + ggtitle(names(mice)[[mn]])+theme(axis.text.x=element_blank(),axis.text.y=element_blank()) + xlim(-70,-50) + ylim(-67.5,-60) + labs(x="",y="")
ggmap(temp) + labs(fill="Mean Probabilty of Feeding")+ geom_tile(data=travdf,aes(x=x, y=y,fill=layer),alpha=0.9)  + scale_color_discrete(guide="none") + scale_fill_continuous(low="blue",high="red")+ geom_tile(data=data.frame(rasterToPoints(mice[[mn]])),aes(x=x,y=y),aes_string(fill=names(mice)[[mn]]),alpha=0.8,fill='snow2') + ggtitle(names(mice)[[mn]])+theme(axis.text.x=element_blank(),axis.text.y=element_blank()) + xlim(-70,-50) + ylim(-67.5,-60) + labs(x="",y="")
ggmap(temp) + labs(fill="Mean Probabilty of Feeding")+ geom_tile(data=travdf,aes(x=x, y=y,fill=layer),alpha=0.9)  + scale_color_discrete(guide="none") + scale_fill_continuous(low="blue",high="red")+ geom_tile(data=data.frame(rasterToPoints(mice[[mn]])),aes(x=x,y=y,fill=names(mice)[[mn]]),alpha=0.8,fill='snow2') + ggtitle(names(mice)[[mn]])+theme(axis.text.x=element_blank(),axis.text.y=element_blank()) + xlim(-70,-50) + ylim(-67.5,-60) + labs(x="",y="")
ggmap(temp) + labs(fill="Mean Probabilty of Feeding")+ geom_tile(data=travdf,aes(x=x, y=y,fill=layer),alpha=0.9)  + scale_color_discrete(guide="none") + scale_fill_continuous(low="blue",high="red")+ geom_tile(data=data.frame(rasterToPoints(mice[[mn]])),aes(x=x,y=y,fill=names(mice)[[mn]]),alpha=0.8,fill='snow2') + ggtitle(names(mice)[[mn]])+theme(axis.text.x=element_blank(),axis.text.y=element_blank()) + xlim(-70,-50) + ylim(-67.5,-60) + labs(x="",y="")
meanpar<-pc %>% filter(parameter %in% c('beta_mu',"beta2_mu",'alpha_mu'))  %>% group_by(par) %>% summarize(mean=mean(value)) %>% dcast(...~par)
##Bathymetry
s<-stack(rice,distc)
#Traveling
travpar<-calc(s,function(x,y){ 1-inv.logit(meanpar$`alpha_mu[1]` + meanpar$`beta_mu[1]` * x[1] + meanpar$`beta2_mu[1]` * x[2])})
travdf<-data.frame(rasterToPoints(travpar))
#plot for all months between jan and july.
for(mn in 25:30){
ggmap(temp) + labs(fill="Mean Probabilty of Feeding")+ geom_tile(data=travdf,aes(x=x, y=y,fill=layer),alpha=0.9)  + scale_color_discrete(guide="none") + scale_fill_continuous(low="blue",high="red")
}
months<-25:30
for(mn in 1:length(months)){
pall1[[x]]<-ggmap(temp) + labs(fill="Mean Probabilty of Feeding")+ geom_tile(data=travdf,aes(x=x, y=y,fill=layer),alpha=0.9)  + scale_color_discrete(guide="none") + scale_fill_continuous(low="blue",high="red")
}
pall1<-list()
for(mn in 1:length(months)){
pall1[[x]]<-ggmap(temp) + labs(fill="Mean Probabilty of Feeding")+ geom_tile(data=travdf,aes(x=x, y=y,fill=layer),alpha=0.9)  + scale_color_discrete(guide="none") + scale_fill_continuous(low="blue",high="red")
}
for(mn in 1:length(months)){
pall1[[mn]]<-ggmap(temp) + labs(fill="Mean Probabilty of Feeding")+ geom_tile(data=travdf,aes(x=x, y=y,fill=layer),alpha=0.9)  + scale_color_discrete(guide="none") + scale_fill_continuous(low="blue",high="red")
}
pall1
length(pall1)
str(pall1)
library(knitr)
opts_chunk$set(echo=F,warning=F,message=F,fig.width = 11,fig.height = 5)
library(boot)
library(raster)
library(reshape2)
library(ggplot2)
library(survival)
library(MASS)
library(ggmap)
library(dplyr)
library(chron)
library(gridExtra)
library(stringr)
library(R2jags)
library(move)
#New model to be run, flag turned off if just updating.
newModel<-T
load("SingleSpecies.RData")
head(oxy)
ggplot() +  geom_path(data=oxy,col='blue',aes(x=x,y=y)) +  geom_path(data=mxy,col='red',aes(x=x,y=y),size=2,alpha=0.7)  + facet_wrap(~individual.local.identifier,scales="free",ncol=4)
hist(rbeta(1e5,0.5,1))
26219.880/60
26219.880/60/60
