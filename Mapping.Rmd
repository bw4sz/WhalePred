---
title: "Mapping"
author: "Ben Weinstein"
date: "April 22, 2016"
output: 
  html_document:
  keep_md: True
  numbered_sections: True
  toc: true
  theme: spacelab
---

```{r}
library(sp)
library(dismo)
library(raster)
library(reshape2)
library(ggplot2)
library(dplyr)
library(chron)
library(moveHMM)
library(move)
library(ggmap)
library(knitr)
opts_chunk$set(echo=F)
```

#Read in data

```{r}
dat<-read.csv("InputData/ArgosData_2016_03_14_22_54_50.csv")
head(dat)

#move object

#Time stamp
dat$TimeStamp<-as.POSIXct(dat$Msg.Date,format="%d/%m/%Y  %H:%M",tz="GMT")

#Need to remove duplicated timestamp?
ddat<-dat %>% group_by(Platform.ID.No.,TimeStamp) %>% distinct() %>% arrange(TimeStamp)

#sort time objects
mdat<-move(x=ddat$Latitude,y=ddat$Longitude,time=ddat$TimeStamp,proj=CRS("+proj=longlat +ellps=WGS84"),animal=ddat$Platform.ID.No.)
```

#Summary statistics

## Number of locations
```{r}
n.locs(mdat)
```

## Time lag

```{r}
tm<-melt(timeLag(mdat,units="mins"))
ggplot(tm,aes(x=value,fill=L1)) + geom_histogram() + facet_wrap(~L1,scales='free') + ggtitle("Time Lag") + xlab("Minutes") + theme_bw()
```

## Derived movement statistics
```{r}
mss<-melt(summary(mdat))
ggplot(mss,aes(x=L1,y=value)) + geom_point() + facet_wrap(~variable,scales="free") + ggtitle("Average Movement") + xlab("Individual") + theme_bw()
```

##Plot raw track
```{r, echo=FALSE}
plot(mdat)
```

### Overlay on googlemap

```{r}
mdat_df <- as(mdat, "data.frame")
m <- get_map(bbox(extent(mdat)*1.1), source="google", zoom=4)
ggmap(m)+geom_path(data=mdat_df, aes(x=x, y=y))
```

